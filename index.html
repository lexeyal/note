<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<title>Записки</title>
	<link rel="stylesheet" type="text/css" href="css/css.css">
</head>
<body>
	<div class="m_body">
	<div class="m_header"><h3>записки для себя</h3></div>

<div class="m_nav">
	<div>
		<a href="#1">20191001</a>
	</div>
	<div>
		<a href="#z2">20191003</a>
	</div>
	<div>
		<a href="#3">20191003</a>
	</div>
</div>

<div class="m_menu">
	1 2 3
</div>
<div class="m_post">
	
<pre id="1">
20200327
@ECHO OFF
REM Выгрузка из базы 1с в mysql базу на www-сервере

SET P_PATH="D:\moving\"
SET P_PROG="%P_PATH%scr\backup.cmd"
SET P_FILE="%P_PATH%ok.txt"

SET BPATH=192.168.X.X\BaseName
SET EXTOBR=".\воВыгрузкаВmysql_m.epf"

SET MPASS="PASS"
SET MUSER="USER"

SET MPROG="C:\Program Files\1cv8\common\1cestart.exe"
SET MPROG="C:\Program Files (x86)\1cv8\common\1cestart.exe"

%MPROG% /S%BPATH% /N %MUSER%  /P %MPASS% /Execute %EXTOBR%

REM
REM Процесс начат, ждем его окончания
REM

:ptest
SET P_T=%time%

SET P_H=%P_T:~0,2% 
SET P_M=%P_T:~3,2%
SET /a P_T_M=P_H*60 + P_M

REM echo %P_T_M%

IF DEFINED P_START GOTO pnext
SET P_START=%P_T_M%
:pnext

SET /a P_X=P_T_M - P_START

REM echo %P_X%

REM Ожидание окончания процесса не может длится >30 минут
IF 30 LSS %P_X% GOTO err


IF NOT EXIST %P_FILE% GOTO psleep
REM Процесс закончен !!!
rem del %P_FILE%
%P_PROG%
GOTO exit


:psleep
REM Процесс еще не закончен, подождем 5 сек
REM echo %time%
timeout 5 > NUL
REM echo %time%

GOTO ptest
:err
ECHO "Time %P_T% more then 30min" > "%P_PATH%err.txt"
:exit



20200326
mysql 
-e "INSERT INTO my_t SET m_date=left(now()+0,8), m_time=right(now()+0,6)"
получится m_date=20200326 m_time=16:12:44
20200325
https://pro1c8.ru/vizvat-proceduru-modulya-objekta/

Как из управляемой формы вызвать процедуру модуля объекта

Довольно часть встречается ситуация, когда из формы какого-то прикладного объекта необходимо вызвать экспортную процедуру или функцию, расположенную в модуле этого объекта.

Напрямую обратиться к процедурам модуля объекта из формы не получится. Связано это с тем, что прикладных объектов на клиенте нет, они существуют только на сервере. На клиенте доступны только специальные типы для отображения данных.

Общая схема вызова серверной процедуры/функции состоит из нескольких этапов:

    Вызов контекстной серверной процедуры формы;
    Преобразование основного реквизита формы в прикладной объект;
    Вызов экспортной процедуры/функции модуля объекта;
    Обратное преобразование прикладного объекта в реквизит формы.

Рассмотрим описанные действия на примере. Предположим, что у документа есть табличная часть с товарами и ценами. Необходимо из формы документа вызвать процедуру модуля объекта, которая применяет для всех строк табличной части скидку в процентах.

Процедура модуля объекта документа для применения скидки:

Процедура ПрименитьСкидку(ПроцентСкидки) Экспорт
    Для каждого СтрокаТЧ Из Товары Цикл
        СтрокаТЧ.Цена = СтрокаТЧ.Цена - СтрокаТЧ.Цена / 100 * ПроцентСкидки;
    КонецЦикла;
КонецПроцедуры

Внимание!

    Процедуры/функции модуля объекта, которые предназначены для вызова извне модуля должны быть экспортными, т.е. иметь ключевое слово Экспорт.

На форме документа расположим кнопку, вызывающую серверную процедуру:

&НаКлиенте
Процедура ПересчитатьЦены(Команда)

    // Этап 1. Вызов серверной процедуры
    ПересчитатьЦеныНаСервре();

КонецПроцедуры

&НаСервере
Процедура ПересчитатьЦеныНаСервре()

    // Этап 2. Преобразование основного реквизита формы в прикладной объект
    ДокументОбъект = РеквизитФормыВЗначение("Объект");
    // Этап 3. Вызов процедуры модуля объекта
    ДокументОбъект.ПрименитьСкидку(5);
    // Этап 4. Обратное преобразование прикладного объекта в реквизит формы
    ЗначениеВРеквизитФормы(ДокументОбъект, "Объект");

КонецПроцедуры
===========================================
20200324
Выключен бухгалтерский шлюз.
1с находила 190-й через него.
...
===========================================
20200323
odbc не может подключится к 190-му
нужно проверить в чем дело
...
===========================================
20200319
1с снова "Установлен безопасный режим...".
Права слетели...
...
===========================================
20200310
1с снова "Установлен безопасный режим...".
Права слетели...
...
===========================================
20200306
1с снова "Установлен безопасный режим...".
Права слетели...
...
===========================================
20200213
Скрипт не сработал...
Оказалось 1c пропала из папки "Program Files" 
и появилась в папке "Program Files (x86)" :)
как так?...
скорее всего причина в обновлениях
- недавно у меня через групповые 
политики (насильно) стали устанавливаться 
обновления...
т.е. 1с без моего ведома превратили из x64 в i386
...
===========================================
20200204
Обновил 1с, а то скрипт не сработал...
...
===========================================
20200129
1с снова "Установлен безопасный режим..."
- версия была обновлена.
Права слетели...
...
===========================================
20200128
1с снова "Установлен безопасный режим..."
- версия была обновлена.
Права слетели...
...
===========================================
20200109
1с снова "Установлен безопасный режим..."
- версия была обновлена.
Права слетели...
...
===========================================
20191209
1. иконки в отдельных файлах, пришлось подключать весь bs

link href="/css/bootstrap-3.4.1-dist/css/bootstrap.min.css" rel="stylesheet"

2. если несколько ресурсов, как в вышеупомянутом примере
с иконками, напримет, то все они (ресурсы), должны ссылаться
или на локальную папку, или на cdn!
В разнобой может не работать!?

...
===========================================
20191119
Для проверки работает ли js
<xmp>
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title></title>
        <link rel='stylesheet' href='../bootstrap/css/bootstrap.min.css' type='text/css' media='all'>
    </head>
    <body>
        <noscript>
            <p class="alert-danger alert">
                JavaScript отключен или не поддерживается!</p>
        </noscript>
        <main id="js_enabled" class="hide">
            Основной контент
        </main>
        <script>
            document.getElementById('js_enabled').className = '';
        </script>
    </body>
</html>

</xmp>
...
===========================================
20191107
1с снова "Установлен безопасный режим..."
Конфигуратор не видит конфигурацию и пользователей,
говорит "Недостаточно прав доступа!"
Права слетели...
...
===========================================
20191106
1с снова "Установлен безопасный режим..."
Конфигуратор не видит конфигурацию и пользователей,
говорит "Недостаточно прав доступа!"
Права слетели...
...
===========================================
20191101
в лине писал
require "../api/api.php";
в винде нужно так
set_include_path('.');
require "/../api/api.php";
а еще лучше переучись и пиши,
не завися от include_path, так:
...
require dirname(__DIR__).'/api/api.php';
...
===========================================
20191030
1c - находится в безопасном режиме...
опять права изменились
добавил роль "Администрирование" - заработало.
ЗЫ.
роль "Полные права" не понадобилась
!!! "Полные права" тоже нужны - при работе с
аспирантами 1с ругается на недостаток прав,
даже при наличии роли "Администрирование"!!!
===========================================
20191029
1c - соединение не может быть установлено...
оказалось buchsrv определился в 7-й подсети!
!!что-то опять в настройках сети нахимичили
добавил в hosts 192.168.0.4 buchsrv 
и успокоился...
===========================================
20191025
bash канкатенация
$ echo 'dd'"ff"
ddff
$ echo "dd""ff"
ddff
в скрипте ДАЖЕ ТАК можно
$ echo `date '+%Y-%m-%d %H:%M:%S start процесс'`

Прикольненько!
===========================================
понадобилось посчитать количество 
каталогов и файлов в папке
$ find ./ -type d -name "*" | wc -l
$ find ./ -type f -name "*" | wc -l
PS. текущий тоже считает!
===========================================
https://losst.ru/rsync-primery-sinhronizatsii
связь медленная переделал скрипт архивирования

#!/bin/sh
# v1.0
datestamp=`date +'%Y-%m-%d'`
whatp='/home/********/'
whatf='*******'
log="./log.txt"

##
echo `date` >> $log
echo "start sync" >> $log
rsync --progress --delete -aogvze "ssh -p ****" **********@*********:$whatp$whatf ./
$whatf ./
echo `date` >> $log
echo "start tgz" >> $log
tar -czf ./$datestamp-$whatf.tgz ./$whatf
echo `date` >> $log
echo "end" >> $log
echo "===================================" >> $log

exit 0


20191024
cake выдал
Error
Please replace src/Templates/Pages/home.ctp with your own version of re-enable debug mode.
https://www.8host.com/blog/nastrojka-prilozheniya-cakephp-na-lamp-v-ubuntu-18-04/

для разработки в config/app.php замени
значение debug с false на true

изменил пароль
mysqladmin --user=root password "******";
настроил
...
===============================================


20191022
см. https://wiki.dieg.info/tar
архивирование с машины ШОЮ проходит ОЧЕНЬ медленно
и не выдерживая напряжения обрывается
архивировать сайт стали так

#!/bin/sh
datestamp=`date +'%Y-%m-%d'`
ssh -p **** ********@******* "mysqldump -p -u********* **********" > ./$datestamp-s.sql
ssh -p **** ********@******* "tar -czvf - /home/*******/*****" > ./$datestamp-s.tgz

exit 0

сначала вводим пароль для ssh (его не видно),
потом для mysql (его видно),
потом снова для ssh (его не видно).
процедура занимает примерно пол-часа.
...
===============================================

20191021
Apache2 v2.4.29
выдал в логах
!!! причем только, когда
!!! LogLevel debug
!!! указал в apache2.conf
Invalid host name 'm_fw', problem near: _fw
т.е. ему не понравился символ подчеркиванмя в имени хлста!!!
v2.4.18 так себя не вел...
Локальный переименовал, но если попадется "не мой"?
...
===============================================
20191017
tag 1C
Перестала работать выгрузка.
Сначала 
"Система находится  в безопасном режиме"
права не помогли...
типа "Не хватает прав"
!!! отладка останавливается на Исключениях
!!! у значка "выполнить" стрелка вниз и ищи Толстый клиент
!!! еще в правах пользователя галку Толстый не забудь
!!! появится кнопка "отладка Толстый клиент"
решилось так
отладка заработала и в запросе была ссылка на поле
которое убрали из базы!!!
Так и хочется сказать "Руки прочь от базы", но, увы...
===============================================
</pre>
<pre id="z2">
20191003
git
- Если что-то перепутал может помочь

git commit --amend
см.
https://habr.com/ru/company/flant/blog/419733/

- при попытке git push выдавал старого пользователя...
оказалось в w7
-панель управления
-учетные записи пользователей
-администрирование учетных записей
общие учетные записи
git сохранил учетку - заходишь в нее и 
удаление из хранилища
дальше как обычно...
и получаешь GUI окно авторизации - отмена
и в консоли как обычно
!НО - также - создается запись :(
===============================================
</pre>
<pre id="3">
20191003
читай 
https://html5book.ru/css-grid/
===============================================

20191001
tag 1C
1с выдала при попытке выполнить внешнюю обработку что-то вот такое:
"Система находится  в безопасном режиме"
Вход в Конфигуратор разрешила, но на попытки:
- открытия конфигурации
- клик по меню "Пользователи"
- запуск Внешней обработки
выдала - "Недостаточно прав"
"У пользователя недостаточно прав на исполнение операции над базой данных""
Оказалось прав или лишили или они слетели...
Решение:
достаточно добавить "Полные права" и ? "Администрирование" :)
===============================================
</pre>

</div>
<div class="m_folder">
	<p>Записки для себя</p>

</div>
</div>
</body>
</html>
